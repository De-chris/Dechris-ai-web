<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Dechris AI - Web Version</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;600&display=swap">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  
  <style>
    :root {
      --bg-color: #121212;
      --input-bg: #212121;
      --accent-blue: #007BFF;
      --ai-bubble: #B22222; /* Red from your App */
      --user-bubble: #FFFFFF;
      --text-main: #F0F0F0;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }

    body {
      background-color: var(--bg-color);
      color: var(--text-main);
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* --- FUTURISTIC SPLASH SCREEN --- */
    #splash {
      position: fixed;
      inset: 0;
      background: #000;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: opacity 0.8s ease;
    }

    .loader-circle {
      width: 100px;
      height: 100px;
      border: 2px solid transparent;
      border-top: 2px solid var(--accent-blue);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      position: relative;
    }

    .loader-circle::before {
      content: '';
      position: absolute;
      inset: 10px;
      border: 2px solid transparent;
      border-bottom: 2px solid #B22222;
      border-radius: 50%;
      animation: spin 2s linear infinite;
    }

    @keyframes spin { 100% { transform: rotate(360deg); } }

    .glitch-text {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.5rem;
      margin-top: 20px;
      letter-spacing: 5px;
      color: var(--accent-blue);
      text-transform: uppercase;
      animation: pulse 1.5s infinite;
    }

    /* --- DRAWER --- */
    #drawer {
      position: fixed;
      top: 0; left: -300px;
      width: 280px; height: 100%;
      background: rgba(18, 18, 18, 0.98);
      border-right: 1px solid #333;
      z-index: 1000;
      transition: 0.3s;
      padding: 20px;
    }
    #drawer.open { left: 0; }

    /* --- CHAT AREA --- */
    .main-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 10px;
      max-width: 900px;
      margin: 0 auto;
      width: 100%;
      padding-top: 60px;
    }

    #chatBox {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    /* Message Bubbles */
    .msg { padding: 12px 18px; border-radius: 20px; max-width: 80%; font-size: 15px; position: relative; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
    .user { align-self: flex-end; background: #FFF; color: #8B0000; border-bottom-right-radius: 2px; }
    .ai { align-self: flex-start; background: #B22222; color: #FFF; border-bottom-left-radius: 2px; }
    .timestamp { font-size: 9px; color: #888; margin-top: 5px; display: block; }

    /* --- INPUT AREA (FIXED AS REQUESTED) --- */
    .input-wrapper {
      background: var(--input-bg);
      border-radius: 25px;
      padding: 8px 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      border: 1px solid #333;
    }

    #userInput {
      flex: 1;
      background: transparent;
      border: none;
      color: white;
      padding: 10px;
      outline: none;
      font-size: 14px;
      resize: none;
      max-height: 100px;
    }

    .model-badge {
      background: var(--bg-color);
      color: #888;
      font-size: 10px;
      padding: 5px 10px;
      border-radius: 15px;
      border: 1px solid #333;
      cursor: pointer;
      text-transform: uppercase;
    }

    .send-btn {
      background: var(--accent-blue);
      width: 40px; height: 40px;
      border-radius: 50%;
      border: none;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0, 123, 255, 0.4);
    }

    /* Header Controls */
    .header { position: fixed; top: 0; left: 0; right: 0; height: 50px; display: flex; align-items: center; padding: 0 15px; background: rgba(18,18,18,0.8); backdrop-filter: blur(10px); z-index: 900; }
    #drawerToggle { background: none; border: none; color: white; font-size: 20px; cursor: pointer; }

    .hidden { display: none !important; }
  </style>
</head>
<body>

  <div id="splash">
    <div class="loader-circle"></div>
    <div class="glitch-text">DECHRIS AI</div>
  </div>

  <div class="header">
    <button id="drawerToggle"><i class="fas fa-bars"></i></button>
    <span style="margin-left: 15px; font-weight: 700; font-family: 'Orbitron';">WEB SYSTEM</span>
  </div>

  <div id="drawer">
    <h3 style="color:var(--accent-blue); margin-bottom:20px;">COMMAND CENTER</h3>
    <button onclick="clearChat()" style="width:100%; padding:10px; background:#212121; color:white; border:none; margin-bottom:10px;"><i class="fas fa-trash"></i> Clear Session</button>
    <button onclick="location.reload()" style="width:100%; padding:10px; background:#212121; color:white; border:none;"><i class="fas fa-sync"></i> Refresh System</button>
  </div>

  <div class="main-container">
    <div id="chatBox"></div>
    
    <div class="input-wrapper">
      <div class="model-badge">LongCat Flash</div>
      <textarea id="userInput" placeholder="Type emergency command..." rows="1"></textarea>
      <button class="send-btn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>

  <script>
    // --- APP LOGIC (Mirroring your Java Code) ---
    let chatList = JSON.parse(localStorage.getItem("web_history") || "[]");
    const username = localStorage.getItem("username") || "Friend";

    // Splash Control
    window.addEventListener('load', () => {
      setTimeout(() => {
        document.getElementById('splash').style.opacity = '0';
        setTimeout(() => document.getElementById('splash').classList.add('hidden'), 800);
      }, 2500);
    });

    // Drawer Control
    document.getElementById('drawerToggle').onclick = () => {
      document.getElementById('drawer').classList.toggle('open');
    };

    function displayMessages() {
      const box = document.getElementById('chatBox');
      box.innerHTML = '';
      chatList.forEach(m => {
        const div = document.createElement('div');
        div.className = `msg ${m.role}`;
        div.innerHTML = `${m.content} <span class="timestamp">${m.time}</span>`;
        box.appendChild(div);
      });
      box.scrollTop = box.scrollHeight;
    }

    async function sendMessage() {
      const input = document.getElementById('userInput');
      const text = input.value.trim();
      if (!text) return;

      const time = new Date().toLocaleString('en-GB', { hour: '2-digit', minute: '2-digit', day: '2-digit', month: 'short', year: 'numeric' });
      
      // Add User Message
      chatList.push({ role: 'user', content: text, time: time });
      input.value = '';
      displayMessages();

      // Preparation (Logic from your Java Code)
      const currentFullDate = new Date().toString();
      const systemPrompt = `You are MASA AI (Medical and Situation Assistance). FEMALE assistant. Attend to Medical/Safety for ${username}. Time: ${currentFullDate}. Refuse trivial tasks.`;
      
      // Build Memory (Last 20)
      let memory = chatList.slice(-20).map(m => ({ role: m.role, content: m.content }));

      try {
        // API 1: LongCat (Mirroring your counter logic)
        const key = (Date.now() % 2 === 0) ? "ak_1gX15h2Sd9sr4SP3gZ84C1KT3gg6R" : "ak_1oM1lq7G33vK9QK2Xu1dF3EL9kZ80";
        
        const response = await fetch("https://api.longcat.chat/openai/v1/chat/completions", {
          method: "POST",
          headers: { "Content-Type": "application/json", "Authorization": `Bearer ${key}` },
          body: JSON.stringify({
            model: "LongCat-Flash-Chat",
            messages: [{ role: "system", content: systemPrompt }, ...memory]
          })
        });

        if (response.ok) {
          const data = await response.json();
          addAssistantReply(data.choices[0].message.content);
        } else {
          throw new Error("API 1 Fail");
        }
      } catch (e) {
        // API 2: Fallback Gemini (Mirroring your Java Logic)
        try {
          const gUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=AIzaSyDwVM8b4K_VB9HDlqn-Y9z5Ehb6ZJq3FvY";
          const gResponse = await fetch(gUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              contents: [{ parts: [{ text: `System: ${systemPrompt}\nHistory: ${JSON.stringify(memory)}\nUser: ${text}` }] }]
            })
          });
          const gData = await gResponse.json();
          addAssistantReply(gData.candidates[0].content.parts[0].text);
        } catch (err) {
          addAssistantReply("System error: Unable to connect to neural network. Please check internet.");
        }
      }
    }

    function addAssistantReply(content) {
      const time = new Date().toLocaleString('en-GB', { hour: '2-digit', minute: '2-digit', day: '2-digit', month: 'short', year: 'numeric' });
      chatList.push({ role: 'ai', content: content, time: time });
      localStorage.setItem("web_history", JSON.stringify(chatList));
      displayMessages();
    }

    function clearChat() {
      if(confirm("Wipe all data?")) {
        chatList = [];
        localStorage.removeItem("web_history");
        displayMessages();
      }
    }

    // Initial Load
    displayMessages();
  </script>
</body>
</html>
