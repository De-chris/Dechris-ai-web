<!-- Full code from <html> to </html>, fixed -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dechris AI</title>
  <link rel="icon" href="logo.png" type="image/png">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Your CSS remains unchanged -->
  <style>
    /* ... all your existing styles are preserved here ... */
  </style>
</head>
<body>
  <!-- HTML elements remain unchanged -->
  <div id="splash">
    <img src="logo.png" alt="Dechris AI Logo">
    <div>Dechris AI</div>
    <small>Dechris AI Web</small>
  </div>

  <button id="drawerToggle">☰</button>
  
  <div id="drawer">
    <button onclick="toggleDarkMode()">🌗 Toggle Dark Mode</button>
    <button onclick="changeName()">👤 Change Your Name</button>
    <button onclick="exportChat()">📤 Export Chat</button>
    <button onclick="clearChats()">🗑️ Clear All Chats</button>
    <hr>
    <a href="https://dechris-ai.en.uptodown.com/android" target="_blank">📲 Download Mobile App</a>
    <a href="mailto:havenova.x@gmail.com" target="_blank">✉️ Contact Havenova-x</a>
    <hr>
    <small style="color:#aaa;font-size:0.8rem;text-align:center">Dechris AI Web</small>
  </div>

  <div class="main hidden">
    <div id="chatBox"></div>
    <div class="app-promo hidden" id="appPromo">
      <button class="close-promo" onclick="closePromo()">×</button>
      Enjoying Dechris AI? Get the full experience with our <a href="https://dechris-ai.en.uptodown.com/android" target="_blank">mobile app</a>!
    </div>
    <div id="inputBox">
      <input type="text" id="userInput" placeholder="Ask something..." onkeydown="handleKeyPress(event)">
      <button onclick="sendMessage()" title="Send message">
        <span class="material-icons" style="font-size:1.2rem">send</span>
      </button>
    </div>
  </div>

  <script>
    let voiceEnabled = true;
    let username = localStorage.getItem("dechris_username") || prompt("What's your name?") || "User";
    localStorage.setItem("dechris_username", username);
    let drawerTimeout;
    const splash = document.getElementById("splash");
    const main = document.querySelector(".main");
    const chatBox = document.getElementById("chatBox");
    const drawer = document.getElementById("drawer");
    const drawerToggle = document.getElementById("drawerToggle");
    const userInput = document.getElementById("userInput");
    const appPromo = document.getElementById("appPromo");

    setTimeout(() => {
      splash.style.display = "none";
      main.classList.remove("hidden");
      loadChatDisplay();
      startDrawerTimer();
      showPromoIfNeeded();
    }, 3000);

    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.body.classList.add("dark-mode");
    }

    drawerToggle.addEventListener("click", (e) => {
      e.stopPropagation();
      drawer.classList.toggle("open");
      resetDrawerTimer();
    });

    // ✅ Fixed this line (added missing closing parenthesis)
    document.addEventListener("click", (e) => {
      if (drawer.classList.contains("open") && !drawer.contains(e.target)) {
        closeDrawer();
      }
    });

    function startDrawerTimer() {
      drawerTimeout = setTimeout(() => {
        drawerToggle.classList.add("hidden");
      }, 3000);
    }

    function resetDrawerTimer() {
      clearTimeout(drawerTimeout);
      drawerToggle.classList.remove("hidden");
      startDrawerTimer();
    }

    document.addEventListener("mousemove", (e) => {
      if (e.clientX < 60) {
        drawerToggle.classList.remove("hidden");
        resetDrawerTimer();
      }
    });

    function showPromoIfNeeded() {
      const lastShowTime = localStorage.getItem("dechris_promo_last_shown");
      const now = new Date().getTime();
      const oneWeek = 7 * 24 * 60 * 60 * 1000;
      if (!lastShowTime || (now - lastShowTime > oneWeek)) {
        appPromo.classList.remove("hidden");
        localStorage.setItem("dechris_promo_last_shown", now);
      }
    }

    function closePromo() {
      appPromo.classList.add("hidden");
    }

    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
      document.body.classList.toggle("light-mode");
      closeDrawer();
    }

    function closeDrawer() {
      drawer.classList.remove("open");
    }

    function changeName() {
      const newName = prompt("Enter your new name:", username) || username;
      if (newName !== username) {
        username = newName;
        localStorage.setItem("dechris_username", newName);
        displayMsg(`System: Your name has been updated to ${username}`, 'ai');
      }
      closeDrawer();
    }

    function clearChats() {
      if (confirm("Are you sure you want to clear all chat history?")) {
        localStorage.removeItem("dechris_chat_display");
        localStorage.removeItem("dechris_chat_memory");
        chatBox.innerHTML = "";
        displayMsg("System: Chat history has been cleared", 'ai');
      }
      closeDrawer();
    }

    function exportChat() {
      let chatText = "Dechris AI Chat History\n\n";
      const messages = chatBox.querySelectorAll('.chat-msg');
      messages.forEach(msg => {
        const sender = msg.classList.contains('user') ? `${username}: ` : 'Dechris AI: ';
        chatText += sender + msg.textContent + '\n\n';
      });
      const blob = new Blob([chatText], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `DechrisAI-Chat-${new Date().toISOString().slice(0,10)}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      displayMsg("System: Chat exported successfully", 'ai');
      closeDrawer();
    }

    function displayMsg(msg, sender) {
      const bubble = document.createElement("div");
      bubble.className = `chat-msg ${sender}`;
      bubble.textContent = msg;
      chatBox.appendChild(bubble);
      chatBox.scrollTop = chatBox.scrollHeight;
      saveChatDisplay();
    }

    function saveChatDisplay() {
      localStorage.setItem("dechris_chat_display", chatBox.innerHTML);
    }

    function loadChatDisplay() {
      const html = localStorage.getItem("dechris_chat_display");
      if (html) {
        chatBox.innerHTML = html;
        if (chatBox.children.length === 0) {
          displayMsg(`Hello ${username}! I'm Dechris AI, your intelligent assistant. You can ask me anything. Also, did you know we have a mobile app? Get it here: https://dechris-ai.en.uptodown.com/android`, 'ai');
        }
      } else {
        displayMsg(`Hello ${username}! I'm Dechris AI, your intelligent assistant. You can ask me anything. Also, did you know we have a mobile app? Get it here: https://dechris-ai.en.uptodown.com/android`, 'ai');
      }
    }

    function saveToMemory(role, content) {
      const mem = JSON.parse(localStorage.getItem("dechris_chat_memory") || "[]");
      mem.push({ role, content });
      localStorage.setItem("dechris_chat_memory", JSON.stringify(mem));
    }

    function getMemory() {
      return JSON.parse(localStorage.getItem("dechris_chat_memory") || "[]");
    }

    function handleKeyPress(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    }

    function sendMessage() {
      const text = userInput.value.trim();
      if (!text) return;

      displayMsg(text, 'user');
      saveToMemory("user", text);
      userInput.value = "";
      userInput.focus();

      let prompt = "System: You are Dechris AI created by the Havenova-x team lead by their founder Dechris, a helpful, calm and intelligent assistant. ";
      prompt += "Keep responses clean, avoid emojis, and never repeat characters or symbols. ";
      prompt += "If any user asks to contact Havenova-x, give them the email havenova.x@gmail.com. ";
      prompt += "Mention that you are also available as a mobile app here: https://dechris-ai.en.uptodown.com/android when appropriate. ";
      prompt += "You are currently chatting with " + username + ".\n";

      const mem = getMemory();
      for (let msg of mem) {
        let c = msg.content.trim();
        if (c.length > 250) c = c.substring(0,250) + "...";
        prompt += (msg.role === "user" ? username + ": " : "Assistant: ") + c + "\n";
      }
      prompt += "Assistant:";

      const url = "https://www.kazeai.site/api/v1?text=" + encodeURIComponent(prompt);

      fetch(url)
        .then(r => r.json())
        .then(data => {
          let reply = data.response || data.error || "I couldn't generate a response. Please try again.";
          reply = reply.replace(/[😀-🙏]/gu, '');
          displayMsg(reply, 'ai');
          saveToMemory("assistant", reply);
        })
        .catch(_ => {
          displayMsg("Sorry, I'm having trouble connecting. Please check your internet connection and try again.", "ai");
        });
    }

    if (/android/i.test(navigator.userAgent)) {
      document.body.innerHTML = `
        <div style="padding:2rem;text-align:center;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;">
          <img src="logo.png" alt="Dechris AI Logo" style="width:80px;height:80px;margin-bottom:1rem;">
          <h2 style="margin-bottom:1rem;">Dechris AI Web is optimized for desktop</h2>
          <p style="margin-bottom:2rem;">For the best experience, please download our mobile app:</p>
          <a href="https://dechris-ai.en.uptodown.com/android" style="padding:1rem 2rem;background:#007bff;color:#fff;border-radius:8px;text-decoration:none;font-weight:600;">
            Download Mobile App
          </a>
        </div>`;
    }
  </script>
</body>
</html>
