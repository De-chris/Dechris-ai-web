<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dechris AI</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }
    body {
      background: linear-gradient(145deg, #0f2027, #203a43, #2c5364);
      color: #000;
      transition: background 0.3s, color 0.3s;
    }
    .dark-mode {
      background: linear-gradient(145deg, #000000, #1a1a1a);
      color: #fff;
    }
    .light-mode {
      background: #fff;
      color: #000;
    }
    .light-mode .user {
      background: #444 !important;
      color: #fff;
    }
    .light-mode .ai {
      color: #000;
    }
    .dark-mode .user {
      background: #333 !important;
    }
    #drawer {
      position: fixed;
      top: 50px;
      left: 10px;
      background: rgba(0,0,0,0.8);
      color: #fff;
      padding: 1rem;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
      z-index: 1000;
      width: 200px;
    }
    #drawer button, #drawer a {
      background: #222;
      color: #fff;
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 5px;
      cursor: pointer;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
    }
    #drawer button:hover, #drawer a:hover {
      background: #333;
    }
    #splash {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #000;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 2em;
      animation: fadeZoom 3s ease-out forwards;
      z-index: 999;
    }
    #splash img {
      width: 100px;
      height: 100px;
      margin-bottom: 1rem;
      animation: pulse 2s infinite ease-in-out;
    }
    #splash small {
      font-size: 0.4em;
      color: #bbb;
    }
    @keyframes fadeZoom {
      0% { transform: scale(1); opacity: 1; }
      25% { transform: scale(1.3); }
      50% { transform: scale(0.8); opacity: 0.8; }
      100% { transform: scale(1.1); opacity: 0; }
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50%      { transform: scale(1.1); opacity: 0.9; }
    }
    .main {
      padding: 1rem;
      max-width: 700px;
      margin: 0 auto;
    }
    #modeBtn {
      position: fixed;
      top: 10px;
      right: 10px;
      padding: 0.4rem 0.6rem;
      font-size: 0.9rem;
      background: #444;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #chatBox {
      margin-top: 4rem;
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }
    .chat-msg {
      padding: 0.8rem 1rem;
      border-radius: 12px;
      margin: 0.2rem 0;
      max-width: 80%;
      word-wrap: break-word;
      line-height: 1.5;
    }
    .user {
      background: rgba(0, 123, 255, 0.2);
      align-self: flex-end;
      color: #000;
    }
    .dark-mode .user { 
      color: #fff;
      background: #333 !important;
    }
    .ai {
      background: transparent !important;
      align-self: flex-start;
      color: #000;
    }
    .dark-mode .ai { 
      color: #fff;
    }
    #inputBox {
      display: flex;
      gap: 0.5rem;
      margin-top: 1.5rem;
      padding: 0.5rem 0;
    }
    #userInput {
      flex: 1;
      padding: 0.7rem 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }
    #inputBox button {
      padding: 0.7rem 1rem;
      border: none;
      background: #007bff;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
    }
    #inputBox button:last-child {
      padding: 0.7rem;
      min-width: 40px;
    }
    .hidden { display: none; }
    .typing-indicator {
      display: inline-block;
      margin-left: 5px;
    }
    .typing-indicator span {
      display: inline-block;
      width: 6px;
      height: 6px;
      background-color: #888;
      border-radius: 50%;
      margin-right: 3px;
      animation: typing 1s infinite ease-in-out;
    }
    .typing-indicator span:nth-child(2) {
      animation-delay: 0.2s;
    }
    .typing-indicator span:nth-child(3) {
      animation-delay: 0.4s;
    }
    @keyframes typing {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    .app-banner {
      background: #007bff;
      color: white;
      padding: 0.8rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      text-align: center;
      display: none;
    }
    .app-banner a {
      color: white;
      text-decoration: underline;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="splash">
    <img src="logo.png" alt="Dechris AI Logo">
    <div>Dechris AI</div>
    <small>Dechris AI Web</small>
  </div>

  <div id="drawer">
    <button onclick="toggleDarkMode()">üåó Toggle Dark Mode</button>
    <button onclick="changeName()">üë§ Change Name</button>
    <button onclick="clearChats()">üóëÔ∏è Clear Chat History</button>
    <button onclick="toggleVoice()">üîä <span id="voiceStatus">Voice: ON</span></button>
    <button onclick="exportChat()">üì§ Export Chat</button>
    <a href="https://dechris-ai.en.uptodown.com/android" target="_blank">üì≤ Get Mobile App</a>
  </div>

  <div class="main hidden">
    <div class="app-banner" id="mobileBanner">
      Enjoy Dechris AI on the go! <a href="https://dechris-ai.en.uptodown.com/android" target="_blank">Download our mobile app</a>
    </div>
    <div id="chatBox"></div>
    <div id="inputBox">
      <input type="text" id="userInput" placeholder="Ask something..." autocomplete="off">
      <button onclick="sendMessage()">Send</button>
      <button onclick="startVoiceInput()">üéô</button>
    </div>
  </div>

  <script>
    let voiceEnabled = true;
    let username = localStorage.getItem("dechris_username") || prompt("What's your name?") || "User";
    localStorage.setItem("dechris_username", username);
    let isTyping = false;

    const splash = document.getElementById("splash");
    const main = document.querySelector(".main");
    const chatBox = document.getElementById("chatBox");
    const voiceStatus = document.getElementById("voiceStatus");
    const mobileBanner = document.getElementById("mobileBanner");

    // Show mobile banner only once per session
    if (!sessionStorage.getItem('bannerShown')) {
      mobileBanner.style.display = 'block';
      sessionStorage.setItem('bannerShown', 'true');
      setTimeout(() => {
        mobileBanner.style.display = 'none';
      }, 10000);
    }

    setTimeout(() => {
      splash.style.display = "none";
      main.classList.remove("hidden");
      loadChatDisplay();
      
      // Initial greeting
      if (chatBox.children.length === 0) {
        showTypingIndicator();
        setTimeout(() => {
          removeTypingIndicator();
          const greeting = `Hello ${username}! I'm Dechris AI, your intelligent assistant. How can I help you today?\n\nBy the way, did you know I'm also available as a mobile app? You can download it here: https://dechris-ai.en.uptodown.com/android`;
          displayMsg(greeting, 'ai');
        }, 1500);
      }
    }, 3000);

    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
      document.body.classList.toggle("light-mode");
    }

    function changeName() {
      const newName = prompt("Enter new name:", username) || "User";
      if (newName !== username) {
        username = newName;
        localStorage.setItem("dechris_username", newName);
        displayMsg(`Name changed to ${newName}`, 'ai');
      }
    }

    function clearChats() {
      if (confirm("Are you sure you want to clear all chat history?")) {
        localStorage.removeItem("dechris_chat_display");
        localStorage.removeItem("dechris_chat_memory");
        chatBox.innerHTML = "";
        displayMsg("Chat history has been cleared.", 'ai');
      }
    }

    function toggleVoice() {
      voiceEnabled = !voiceEnabled;
      voiceStatus.textContent = `Voice: ${voiceEnabled ? "ON" : "OFF"}`;
      displayMsg(`Voice feedback ${voiceEnabled ? "enabled" : "disabled"}`, 'ai');
    }

    function exportChat() {
      let chatText = '';
      const messages = chatBox.querySelectorAll('.chat-msg');
      messages.forEach(msg => {
        const sender = msg.classList.contains('user') ? username : 'Dechris AI';
        chatText += `${sender}: ${msg.textContent}\n\n`;
      });
      
      const blob = new Blob([chatText], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `DechrisAI_Chat_${new Date().toISOString().slice(0,10)}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function showTypingIndicator() {
      if (isTyping) return;
      isTyping = true;
      const typingDiv = document.createElement('div');
      typingDiv.className = 'chat-msg ai';
      typingDiv.id = 'typingIndicator';
      typingDiv.innerHTML = 'Thinking<span class="typing-indicator"><span></span><span></span><span></span></span>';
      chatBox.appendChild(typingDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function removeTypingIndicator() {
      isTyping = false;
      const indicator = document.getElementById('typingIndicator');
      if (indicator) indicator.remove();
    }

    function displayMsg(msg, sender) {
      removeTypingIndicator();
      const bubble = document.createElement("div");
      bubble.className = `chat-msg ${sender}`;
      bubble.textContent = msg;
      chatBox.appendChild(bubble);
      chatBox.scrollTop = chatBox.scrollHeight;
      saveChatDisplay();
    }

    function saveChatDisplay() {
      localStorage.setItem("dechris_chat_display", chatBox.innerHTML);
    }

    function loadChatDisplay() {
      const html = localStorage.getItem("dechris_chat_display");
      if (html) chatBox.innerHTML = html;
    }

    function saveToMemory(role, content) {
      const mem = JSON.parse(localStorage.getItem("dechris_chat_memory") || "[]");
      mem.push({ role, content });
      localStorage.setItem("dechris_chat_memory", JSON.stringify(mem));
    }

    function getMemory() {
      return JSON.parse(localStorage.getItem("dechris_chat_memory") || "[]");
    }

    function sendMessage() {
      const input = document.getElementById("userInput");
      const text = input.value.trim();
      if (!text) return;
      
      displayMsg(text, 'user');
      saveToMemory("user", text);
      input.value = "";
      
      showTypingIndicator();

      let prompt = "System: You are Dechris AI created by the Havenova-x team lead by their founder Dechris, a helpful, calm and intelligent assistant. ";
      prompt += "Keep responses clean, avoid emojis, and never repeat characters or symbols. ";
      prompt += "If any user asks to contact Havenova-x, give them the email havenova.x@gmail.com. ";
      prompt += "Mention that you are also available as a mobile app here: https://dechris-ai.en.uptodown.com/android when appropriate. ";
      prompt += "You are currently chatting with " + username + ".\n";

      const mem = getMemory();
      for (let msg of mem) {
        let c = msg.content.trim();
        if (c.length > 250) c = c.substring(0,250) + "...";
        prompt += (msg.role === "user" ? username + ": " : "Assistant: ") + c + "\n";
      }
      prompt += "Assistant:";

      const url = "https://www.kazeai.site/api/v1?text=" + encodeURIComponent(prompt);

      fetch(url)
        .then(r => r.json())
        .then(data => {
          let reply = data.response || data.error || "I couldn't generate a response. Please try again.";
          reply = reply.replace(/[üòÄ-üôè]/gu, '');
          displayMsg(reply, 'ai');
          if (voiceEnabled) speak(reply);
          saveToMemory("assistant", reply);
        })
        .catch(_ => {
          displayMsg("Sorry, I'm having trouble connecting. Please check your internet connection and try again.", "ai");
        });
    }

    function speak(text) {
      if ('speechSynthesis' in window && voiceEnabled) {
        const u = new SpeechSynthesisUtterance(text);
        u.rate = 1.0;
        u.pitch = 1.0;
        window.speechSynthesis.speak(u);
      }
    }

    function startVoiceInput() {
      if (!('webkitSpeechRecognition' in window)) {
        alert("Voice input is not supported in your browser");
        return;
      }
      const rec = new webkitSpeechRecognition();
      rec.lang = "en-US";
      rec.interimResults = false;
      rec.maxAlternatives = 1;
      
      const voiceButton = document.querySelector('#inputBox button:last-child');
      voiceButton.textContent = "üéô Listening...";
      voiceButton.style.background = "#ff5722";
      
      rec.start();
      
      rec.onresult = e => {
        const transcript = e.results[0][0].transcript;
        document.getElementById("userInput").value = transcript;
        voiceButton.textContent = "üéô";
        voiceButton.style.background = "#007bff";
        sendMessage();
      };
      
      rec.onerror = e => {
        voiceButton.textContent = "üéô";
        voiceButton.style.background = "#007bff";
        displayMsg("Voice input failed: " + e.error, 'ai');
      };
      
      rec.onend = () => {
        if (voiceButton.textContent === "üéô Listening...") {
          voiceButton.textContent = "üéô";
          voiceButton.style.background = "#007bff";
        }
      };
    }

    document.getElementById("userInput").addEventListener('keypress', function(e) {
      if (e.key === 'Enter') sendMessage();
    });

    if (/android/i.test(navigator.userAgent)) {
      document.body.innerHTML = `
        <div style="padding:2rem;text-align:center">
          <h2>Dechris AI Web is not optimized for Android</h2>
          <p>For the best experience, please download our mobile app:</p>
          <a href="https://dechris-ai.en.uptodown.com/android" style="padding:1rem;background:#007bff;color:#fff;border-radius:8px;text-decoration:none;display:inline-block;margin-top:1rem;">
            Download Mobile App
          </a>
        </div>`;
    }
  </script>
</body>
</html>
